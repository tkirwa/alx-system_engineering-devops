#!/usr/bin/env bash

# Fixes the issue with the server

# Change permissions of the nginx.conf file to 644
chmod 644 /etc/nginx/nginx.conf

# Replace the 'user' directive in nginx.conf with 'user nginx;'
sed -Ei 's/\s*#?\s*user .*/user nginx;/' /etc/nginx/nginx.conf

# Modify the default Nginx server configuration to listen on port 80
sed -Ei 's/(listen (\[::\]:)?80) /\180 /' /etc/nginx/sites-enabled/default

# Terminate any running instances of Apache2
pkill apache2

# Restart the Nginx service as the 'nginx' user
su nginx -s /bin/bash -c 'service nginx restart'
